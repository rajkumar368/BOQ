<odoo>
    <template id="cboq_summary_template" name="CBOQ Summary">
        <html>
            <head>
                <link rel="stylesheet" href="/BOQ/static/src/css/site_config.css"/>
            </head>
            <body>
                
                <div class="container mt-4">
                    <!-- <div class="logout-header">
                        <h1 class="m-0">CBOQ Summary for Siter <t t-esc="site.site_name"/></h1>
                        <a href="/site-config" class="btn btn-primary save-button ml-auto">Back to Home</a>
                        <a href="/logout" class="logout-btn">Logout</a>
                    </div> -->
                     <div class="logout-header d-flex justify-content-between align-items-center">
                        <h1 class="m-0">CBOQ Summary for Site <t t-esc="site.site_name"/></h1>
                        <div class="d-flex">
                            <a href="/site-config" class="btn btn-primary save-button" style="padding-top: 6px;padding-bottom: 7px;text-decoration: none;">Back to Home</a>
                            <a href="/logout" class="btn btn-danger logout-btn ml-2">Logout</a>
                        </div>
                    </div>

                    <!-- <h2>CBOQ Summary for Site <t t-esc="site.site_name"/></h2> -->

                    <t t-foreach="cboq_data" t-as="cboq_info">
                        <div class="card mb-4">
                            <!-- header with toggle button -->
                            <div class="card-header" t-attf-id="heading-#{cboq_info['cboq'].id}">
                                <h5 class="mb-0">
                                    <button class="btn btn-link"
                                            t-attf-onclick="toggleCard('collapse-#{cboq_info['cboq'].id}')">
                                        <strong>CBOQ #</strong>: <t t-esc="cboq_info['cboq'].name"/> |
                                        <strong>Version</strong>: <t t-esc="cboq_info['cboq'].version_label"/> |
                                        <strong>Status</strong>: <t t-esc="cboq_info['cboq'].status"/> |
                                        <strong>Config Version</strong>: <t t-esc="cboq_info['cboq'].config_version_id.config_versioned"/> |
                                        <strong>Total Amount</strong>: <t t-esc="round(cboq_info['cboq'].total_amount, 2)"/>
                                    </button>
                                </h5>
                            </div>

                            <!-- collapsible body -->
                            <div t-attf-id="collapse-#{cboq_info['cboq'].id}"
                                 class="card-body"
                                 style="display:none">
                                <!-- action buttons -->
                                <div class="card-footer">
                                    <form t-attf-action="/cboq-summary/delete/#{cboq_info['cboq'].id}" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this draft?');" t-if="cboq_info['cboq'].status != 'submitted'">Delete Draft</button>
                                    </form>
                                    <form t-attf-action="/cboq-summary/submit/#{cboq_info['cboq'].id}" method="post" style="display:inline;">
                                        <button type="submit" class="btn btn-primary" t-if="cboq_info['cboq'].status != 'submitted'">Submit TAF</button>
                                    </form>
                                    <a t-attf-href="/create-cboq?site_id=#{cboq_info['cboq'].site_id.id}&amp;config_id=#{cboq_info['cboq'].config_version_id.id}" class="btn btn-secondary" t-if="cboq_info['cboq'].status == 'draft'">Back to Editor</a>
                                    <a t-attf-href="/cboq-summary/export/#{cboq_info['cboq'].id}" class="btn btn-secondary" t-if="cboq_info['cboq'].status != 'draft'">Export TAF</a>
                                </div>

                                <!-- category totals -->
                                <h4>Category Totals</h4>
                                <table class="table table-sm">
                                    <thead><tr><th>Category</th><th>Total Price</th></tr></thead>
                                    <tbody>
                                        <tr t-foreach="cboq_info['category_totals'].items()" t-as="category_total">
                                            <td><t t-esc="category_total[0]"/></td>
                                            <td><t t-esc="round(category_total[1], 2)"/></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <!-- full line list -->
                                <h4>Full Lines</h4>
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Type</th><th>Category</th><th>Description</th>
                                            <th>Qty</th><th>Unit Price</th><th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr t-foreach="cboq_info['cboq'].line_ids" t-as="line">
                                            <td t-esc="dict(line._fields['source_type'].selection).get(line.source_type)"/>
                                            <td t-esc="line.category"/>
                                            <td t-esc="line.description"/>
                                            <td t-esc="line.qty"/>
                                            <td t-esc="round(line.unit_price, 2)"/>
                                            <td t-esc="round(line.total_price, 2)"/>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </t>
                </div>

                <!-- toggle script -->
                <script>
                function toggleCard(id) {
                    const el = document.getElementById(id);
                    if (!el) { console.error('Card not found:', id); return; }
                    el.style.display = (el.style.display === 'none') ? 'block' : 'none';
                }
                </script>
            </body>
        </html>
    </template>
</odoo>